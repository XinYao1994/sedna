apiVersion: sedna.io/v1alpha1
kind: FederatedLearningJob
metadata:
  name: yolo-v5
spec:
  stopCondition:
    operator: "or" # and
    conditions:
      - operator: ">"
        threshold: 100
        metric: rounds
      - operator: ">"
        threshold: 0.95
        metric: target_accuracy
      - operator: "<"
        threshold: 0.03
        metric: delta_loss
  transimitter:
    transimitterAlgorithms:
      - name: "simple" # simple, adaptive_freezing, adaptive_sync ...
  aggregationTrigger:
    condition:
      operator: ">"
      threshold: 5
      metric: num_of_select_clients
  aggregationWorker:
    model:
      name: "surface-defect-detection-model"
    template:
      spec:
        nodeName: "cloud"
        containers:
          - image: kubeedge/sedna-fl-aggregation:mistnetyolo
            name: agg-worker
            imagePullPolicy: IfNotPresent
            volumeMounts:
              - mountPath: /dev/shm
                name: dshm
            env: # user defined environments
              - name: "cut_layer"
                value: "4"
              - name: "epsilon"
                value: "100"
              - name: "aggregation_algorithm"
                value: "mistnet"
              - name: "batch_size"
            resources: # user defined resources
              limits:
                memory: 2Gi
        volumes:
          - name: dshm
            emptyDir:
              medium: Memory
  trainingWorkers:
    - dataset:
        name: "edge1-surface-defect-detection-dataset"
      template:
        spec:
          nodeName: "edge1"
          containers:
            - image: kubeedge/sedna-fl-train:mistnetyolo
              name: train-worker
              imagePullPolicy: IfNotPresent
              env: # user defined environments
                - name: "batch_size"
                  value: "32"
                - name: "learning_rate"
                  value: "0.001"
                - name: "epochs"
                  value: "1"
              resources: # user defined resources
                limits:
                  memory: 2Gi
